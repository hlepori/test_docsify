# Metadata for FIXM

## GUFI

### Assumptions:
- The GUFI is an unaltered ISO UUID v4;   
- A need is identified/confirmed to record and exchange the time at which the GUFI was generated to support some traceability objectives and to help simplify the process for confirming a GUFI is unique over some timeframe.    
- A need is identified/confirmed to record and exchange information about the GUFI origination process (in particular who has created the GUFI), to support investigation and resolution of issues in case of e.g. GUFI collisions or multiple GUFI assignmenets to the same flight.    
- Generic ISO UUID v4 generation services may be provided by third parties and used by FF-ICE Participants. In other terms, an eAU consuming the FF-ICE Filing Service may therefore rely on an external thord-party service for the generation of the GUFIs to be assigned to its eFPLs.  

### Leveraging the ISO 19115 standard 
The ISO 19115-1 standard defines the schema required for describing geographic information and services by means of metadata. It provides information about the identification, the extent, the quality, the spatial and temporal aspects, the content, the spatial reference, the portrayal, distribution, and other properties of digital geographic data and services.

The ISO 19115-1 defines in particular `Lineage` data structures that support the provision of metadata concerning the sources and production processes used in producing a resource. These data structures may be considered for exchanging information about the sources and production processes used in producing the GUFI, in line with the candidate requirements above.

### Mapping the metadata requirements for GUFI to ISO 19115 data structures
- `LI_ProcessStep.description` may store the name of GUFI production process step that is being considered, for instance `GUFI Generation`.
   - Guidance would be needed to ensure harmonised encoding of the property 
- `LI_ProcessStep.stepDateTime` could store the GUFI creation timestamp, for the `GUFI Generation` step.
- `LI_ProcessStep.processor` could store the name of the organisation that has generated the GUFI, when the GUFI generation is not "delegated" to a third-party service
- `LI_ProcessStep.source` could store information about a third-party GUFI generation service, when the GUFI generation is "delegated".

### Examples of encoding of GUFI metadata in FIXM

#### General approach
- Do not import the ISO 19115 schema that is known for its complexity (i.e. self-references) which make it complex to implement.
- Instead, mimic the relevant ISO 19115 data structures into the Base package of FIXM (xmlns:fb="http://www.fixm.aero/base/4.3"). This approach is similar to what is already done by FIXM: mimicking the GML structure for point, and mimicking the xlink:href structure.     
- Preserve the ISO 19115 semantics, in order to ensure semantic alignement of FIXM with this ISO standard and the AIRM (the AIRM uses ISO 19115).  

#### Scenario 1
The name of the eAU is `My Airline`. The eAU runs its own flight planning systems (i.e. does not use the services from a CFSP). No third-party service is used for the generation of the GUFI. The GUFI is generated by the eAU `My Airline` when creating the first Filed Flight Plan or Preliminary Flight Plan for a given flight.

```xml
<fb:processStep>
  <fb:description>GUFI Generation</fb:description>
  <fb:processor>
    <fb:organisationName>My Airline</fb:organisationName>
  </fb:processor>
<fb:stepDateTime>2021-01-01T00:00:00Z</fb:stepDateTime>	
```
 
#### Scenario 2
The name of the eAU is `My Airline`. The eAU uses the services from a CFSP called `My CFSP`. No third-party service is used for the generation of the GUFI. The GUFI is generated by the CFSP `My CFSP` when creating the first Filed Flight Plan or Preliminary Flight Plan for a given flight.

```xml
<fb:processStep>
  <fb:description>GUFI Generation</fb:description>
  <fb:processor>
    <fb:organisationName>My CFSP</fb:organisationName>
  </fb:processor>
<fb:stepDateTime>2021-01-01T00:00:00Z</fb:stepDateTime>	
```

#### Scenario 3
The name of the eAU is `My Airline`. The eAU runs its own flight planning systems (i.e. does not use the services from a CFSP). A third-party service is used for the generation of the GUFI. The name of the service is `UUID Generation Service`. The overview of this third-party service  is available at the url "https://eur-registry.swim.aero/services/uuid_generation_service"

```xml
<fb:processStep>
  <fb:description>GUFI Generation</fb:description>
  <fb:source>
    <fb:sourceCitation>
      <fb:onlineResource>
        <fb:linkage>https://eur-registry.swim.aero/services/uuid_generation_service</fb:linkage>
        <fb:name>UUID Generation Service</fb:name>
      </fb:onlineResource>
    </fb:sourceCitation>
  </fb:source>
<fb:stepDateTime>2021-01-01T00:00:00Z</fb:stepDateTime>	
```

### Where to encode the GUFI metadata in FIXM

#### OPTION 1: generic flight metadata property
Use a generic property called `flightMetadata` defined under `fx:Flight`. This property would be of type `Metadata`, which would mimic the ISO 19115 `MD_Metadata` data element.   

Applied to Scenario 1 above, the resulting encoding would look like this: 
```xml
<ffice:FficeMessage xmlns:ffice="http://www.fixm.aero/app/ffice/1.1" xmlns:fx="http://www.fixm.aero/flight/4.3" xmlns:fb="http://www.fixm.aero/base/4.3">
  <ffice:flight>
    <fx:flightMetadata>
      <fb:resourceLineage>
        <fb:processStep>
          <fb:description>GUFI Generation</fb:description>
          <fb:processor>
            <fb:organisationName>My Airline</fb:organisationName>
          </fb:processor>
          <fb:stepDateTime>2021-01-01T00:00:00Z</fb:stepDateTime>					
        </fb:processStep>
      </fb:resourceLineage>
    </fx:flightMetadata>
    <fx:gufi codeSpace="urn:uuid">AAAAAAAA-AAAA-4AAA-8AAA-AAAAAAA23041</fx:gufi>
  </ffice:flight>	
  <ffice:type>FILED_FLIGHT_PLAN</ffice:type>
</ffice:FficeMessage>
```

#### OPTION 2: specific gufiLineage property
Use a specific property called `gufiLineage` defined under `fx:Flight`. This property would be of type `Lineage`, which would mimic the ISO 19115 `LI_Lineage` data element. 

Applied to Scenario 1 above, the resulting encoding would look like this:
```xml
<ffice:FficeMessage xmlns:ffice="http://www.fixm.aero/app/ffice/1.1" xmlns:fx="http://www.fixm.aero/flight/4.3" xmlns:fb="http://www.fixm.aero/base/4.3">
	<ffice:flight>
		<fx:gufi codeSpace="urn:uuid">AAAAAAAA-AAAA-4AAA-8AAA-AAAAAAA23041</fx:gufi>
		<fx:gufiLineage>
			<fb:processStep>
				<fb:description>GUFI Origination</fb:description>
				<fb:processor>
					<fb:organisationName>My Airline</fb:organisationName>
				</fb:processor>
				<fb:stepDateTime>2021-01-01T00:00:00Z</fb:stepDateTime>					
			</fb:processStep>
		</fx:gufiLineage>
	</ffice:flight>
	<ffice:type>FILED_FLIGHT_PLAN</ffice:type>
</ffice:FficeMessage>
```
